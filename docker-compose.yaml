version: "3.3"
services:
  influxdb:
    container_name: influxdb
    image: influxdb:latest
    expose:
      - 8086
    user: root
    restart: on-failure
    volumes:
      - "influxdb-storage:/var/influxdb/data"
    environment:
      - INFLUXDB_DB="db1"
      - INFLUXDB_ADMIN_USER="root"
      - INFLUXDB_ADMIN_PASSWORD="VerySecurePassword"
      - INFLUXDB_READ_USER="grafana"
      - INFLUXDB_READ_USER_PASSWORD="VerySecurePassword"
    ports:
      - 8086:8086
  telegraf:
    container_name: telegraf
    image: tty0/isp_telegraf:latest
    user: root
    restart: on-failure
    volumes:
      - "./telegraf/conf/telegraf.conf:/etc/telegraf/telegraf.conf:ro"
    links:
      - "influxdb"
    depends_on:
      - "influxdb"
  grafana:
    container_name: grafana
    image: grafana/grafana:latest
    environment:
      - GF_INSTALL_PLUGINS=https://grafana.com/api/plugins/gowee-traceroutemap-panel/versions/0.2.3/download;gowee-traceroutemap-panel
    expose:
      - 3000
    ports:
      - 3000:3000
    restart: on-failure
    volumes:
      - "grafana-storage:/var/lib/grafana"
    links:
      - "influxdb"
    depends_on:
      - "influxdb"
      - "telegraf"
volumes:
  grafana-storage:
    external: true
  influxdb-storage:
    external: true
